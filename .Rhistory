# (You can swap this for any mean structure you want)
mu <- 3 + 1.2 * x + 0.8 * sin(2 * x)
# Non-normal noise: skewed, but centered to mean ~ 0 so y = mu + eps makes sense
# Start with Gamma, then center it
eps_raw <- rgamma(n, shape = 2.2, scale = 0.6)     # right-skewed
eps <- eps_raw - mean(eps_raw)                     # center around 0
# Observed outcome
y <- mu + eps
# Put into a tidy long format for plotting
d <- tibble(
x = x,
signal = mu,
noise  = eps,
observed = y
) |>
pivot_longer(cols = c(observed, signal, noise),
names_to = "component",
values_to = "value") |>
mutate(component = factor(component, levels = c("observed", "signal", "noise")))
# -----------------------------
# 2) Static “teaching” density plot (simple)
# -----------------------------
p_static <- ggplot(d, aes(value, fill = component)) +
geom_density(alpha = 0.35, linewidth = 0.7) +
theme_minimal() +
labs(
x = NULL,
y = "Density",
title = "Observed data = Signal + Noise",
subtitle = "Noise is right-skewed (non-normal) and is added to the systematic structure"
) +
guides(fill = "none")
p_static
# -----------------------------
# 3) Animation: noise gets “pulled out” of observed
#    Stage 1: Observed only
#    Stage 2: Add Signal
#    Stage 3: Add Noise (and show the decomposition explicitly)
# -----------------------------
# Helper: define stage-specific visibility (alpha) for each component
d_anim <- d |>
crossing(stage = factor(c("1) Observed",
"2) Signal",
"3) Noise"),
.name_repair = "minimal") |>
mutate(alpha_stage = case_when(
stage == "1) Observed" & component == "observed" ~ 0.80,
stage == "1) Observed"                           ~ 0.00,
stage == "2) Signal"  & component %in% c("observed", "signal") ~ 0.45,
stage == "2) Signal"                                          ~ 0.00,
stage == "3) Noise"   & component == "observed" ~ 0.25,
stage == "3) Noise"   & component == "signal"   ~ 0.35,
stage == "3) Noise"   & component == "noise"    ~ 0.55,
TRUE ~ 0.00
),
label = case_when(
stage == "1) Observed" ~ "We start with observed data (what we measured).",
stage == "2) Signal"   ~ "Model the systematic structure: E[Y|X] = signal.",
stage == "3) Noise"    ~ "Residual = observed − signal.\nAssume a distribution for the noise."
))
p_anim <- ggplot(d_anim, aes(value, fill = component)) +
# ============================================================
# GLM intro: Observed = Signal + Noise (non-normal noise)
# Density plots + animation showing noise being "pulled out"
# ============================================================
# Packages
library(tidyverse)
library(gganimate)
set.seed(1)
# -----------------------------
# 1) Simulate a signal + non-normal noise process
# -----------------------------
n <- 2000
# A predictor (just to create a range of expected values)
x <- runif(n, -2, 2)
# "Signal" (systematic structure): smooth, deterministic mean function
# (You can swap this for any mean structure you want)
mu <- 3 + 1.2 * x + 0.8 * sin(2 * x)
# Non-normal noise: skewed, but centered to mean ~ 0 so y = mu + eps makes sense
# Start with Gamma, then center it
eps_raw <- rgamma(n, shape = 2.2, scale = 0.6)     # right-skewed
eps <- eps_raw - mean(eps_raw)                     # center around 0
# Observed outcome
y <- mu + eps
# Put into a tidy long format for plotting
d <- tibble(
x = x,
signal = mu,
noise  = eps,
observed = y
) |>
pivot_longer(cols = c(observed, signal, noise),
names_to = "component",
values_to = "value") |>
mutate(component = factor(component, levels = c("observed", "signal", "noise")))
# -----------------------------
# 2) Static “teaching” density plot (simple)
# -----------------------------
p_static <- ggplot(d, aes(value, fill = component)) +
geom_density(alpha = 0.35, linewidth = 0.7) +
theme_minimal() +
labs(
x = NULL,
y = "Density",
title = "Observed data = Signal + Noise",
subtitle = "Noise is right-skewed (non-normal) and is added to the systematic structure"
) +
guides(fill = "none")
p_static
# -----------------------------
# 3) Animation: noise gets “pulled out” of observed
#    Stage 1: Observed only
#    Stage 2: Add Signal
#    Stage 3: Add Noise (and show the decomposition explicitly)
# -----------------------------
# Helper: define stage-specific visibility (alpha) for each component
d_anim <- d |>
crossing(stage = factor(c("1) Observed",
"2) Signal",
"3) Noise"),
.name_repair = "minimal") |>
mutate(alpha_stage = case_when(
stage == "1) Observed" & component == "observed" ~ 0.80,
stage == "1) Observed"                           ~ 0.00,
stage == "2) Signal"  & component %in% c("observed", "signal") ~ 0.45,
stage == "2) Signal"                                          ~ 0.00,
stage == "3) Noise"   & component == "observed" ~ 0.25,
stage == "3) Noise"   & component == "signal"   ~ 0.35,
stage == "3) Noise"   & component == "noise"    ~ 0.55,
TRUE ~ 0.00
),
label = case_when(
stage == "1) Observed" ~ "We start with observed data (what we measured).",
stage == "2) Signal"   ~ "Model the systematic structure: E[Y|X] = signal.",
stage == "3) Noise"    ~ "Residual = observed − signal.\nAssume a distribution for the noise."
))
p_anim <- ggplot(d_anim, aes(value, fill = component)) +
# ============================================================
# GLM intro: Observed = Signal + Noise (non-normal noise)
# Density plots + animation showing noise being "pulled out"
# ============================================================
# Packages
```{r}
library(tidyverse)
library(gganimate)
set.seed(1)
# -----------------------------
# 1) Simulate a signal + non-normal noise process
# -----------------------------
n <- 2000
# A predictor (just to create a range of expected values)
x <- runif(n, -2, 2)
# "Signal" (systematic structure): smooth, deterministic mean function
# (You can swap this for any mean structure you want)
mu <- 3 + 1.2 * x + 0.8 * sin(2 * x)
# Non-normal noise: skewed, but centered to mean ~ 0 so y = mu + eps makes sense
# Start with Gamma, then center it
eps_raw <- rgamma(n, shape = 2.2, scale = 0.6)     # right-skewed
eps <- eps_raw - mean(eps_raw)                     # center around 0
# Observed outcome
y <- mu + eps
# Put into a tidy long format for plotting
d <- tibble(
x = x,
signal = mu,
noise  = eps,
observed = y
) |>
pivot_longer(cols = c(observed, signal, noise),
names_to = "component",
values_to = "value") |>
mutate(component = factor(component, levels = c("observed", "signal", "noise")))
# -----------------------------
# 2) Static “teaching” density plot (simple)
# -----------------------------
p_static <- ggplot(d, aes(value, fill = component)) +
geom_density(alpha = 0.35, linewidth = 0.7) +
theme_minimal() +
labs(
x = NULL,
y = "Density",
title = "Observed data = Signal + Noise",
subtitle = "Noise is right-skewed (non-normal) and is added to the systematic structure"
) +
guides(fill = "none")
p_static
# -----------------------------
# 3) Animation: noise gets “pulled out” of observed
#    Stage 1: Observed only
#    Stage 2: Add Signal
#    Stage 3: Add Noise (and show the decomposition explicitly)
# -----------------------------
# Helper: define stage-specific visibility (alpha) for each component
d_anim <- d |>
crossing(stage = factor(c("1) Observed",
"2) Signal",
"3) Noise"),
.name_repair = "minimal") |>
mutate(alpha_stage = case_when(
stage == "1) Observed" & component == "observed" ~ 0.80,
stage == "1) Observed"                           ~ 0.00,
stage == "2) Signal"  & component %in% c("observed", "signal") ~ 0.45,
stage == "2) Signal"                                          ~ 0.00,
stage == "3) Noise"   & component == "observed" ~ 0.25,
stage == "3) Noise"   & component == "signal"   ~ 0.35,
stage == "3) Noise"   & component == "noise"    ~ 0.55,
TRUE ~ 0.00
),
label = case_when(
stage == "1) Observed" ~ "We start with observed data (what we measured).",
stage == "2) Signal"   ~ "Model the systematic structure: E[Y|X] = signal.",
stage == "3) Noise"    ~ "Residual = observed − signal.\nAssume a distribution for the noise."
))
p_anim <- ggplot(d_anim, aes(value, fill = component)) +
# ============================================================
# Observed = Signal + Noise (non-normal noise) + animation
# ============================================================
```{r}
# ============================================================
# Observed = Signal + Noise (non-normal noise) + animation
# ============================================================
```{r}
library(tidyverse)
library(gganimate)
set.seed(1)
# --- 1) Simulate data: signal + skewed (non-normal) noise ----
n <- 2000
x <- runif(n, -2, 2)
# Systematic structure (signal)
mu <- 3 + 1.2 * x + 0.8 * sin(2 * x)
# Non-normal noise (right-skewed), centered to mean ~ 0
eps_raw <- rgamma(n, shape = 2.2, scale = 0.6)
eps <- eps_raw - mean(eps_raw)
# Observed = signal + noise
y <- mu + eps
# Long/tidy for plotting
d_long <- tibble(
observed = y,
signal   = mu,
noise    = eps
) |>
pivot_longer(everything(), names_to = "component", values_to = "value") |>
mutate(component = factor(component, levels = c("observed", "signal", "noise")))
# --- 2) Static density plot -----------------------------------
p_static <- ggplot(d_long, aes(value, fill = component)) +
geom_density(alpha = 0.35) +
theme_minimal() +
labs(
x = NULL, y = "Density",
title = "Observed = Signal + Noise",
subtitle = "Noise here is intentionally non-normal (skewed)"
) +
guides(fill = "none")
p_static
stages <- tibble(
stage = factor(c("1) Observed", "2) Signal", "3) Noise"),
stage_label = c(
"Start with observed data (what we measured).",
"Add the systematic structure: E[Y|X] = signal.",
"Residual = observed_signal. In a GLM, we assume a distribution for the noise."
)
))
stages <- tibble(
stage = factor(c("1) Observed", "2) Signal", "3) Noise")),
stage_label = c(
"Start with observed data (what we measured).",
"Add the systematic structure: E[Y|X] = signal.",
"Residual = observed_signal. In a GLM, we assume a distribution for the noise."
)
)
d_anim <- d_long |>
crossing(stages) |>
mutate(alpha_stage = case_when(
stage == "1) Observed" & component == "observed" ~ 0.85,
stage == "1) Observed"                           ~ 0.00,
stage == "2) Signal"  & component == "observed" ~ 0.35,
stage == "2) Signal"  & component == "signal"   ~ 0.55,
stage == "2) Signal"                            ~ 0.00,
stage == "3) Noise"   & component == "observed" ~ 0.20,
stage == "3) Noise"   & component == "signal"   ~ 0.30,
stage == "3) Noise"   & component == "noise"    ~ 0.65,
TRUE ~ 0.00
))
p_anim <- ggplot(d_anim, aes(value, fill = component)) +
geom_density(aes(alpha = alpha_stage)) +
theme_minimal() +
labs(
x = NULL, y = "Density",
title = "{closest_state}",
subtitle = "{stage_label}"
) +
guides(fill = "none", alpha = "none") +
transition_states(stage, transition_length = 1, state_length = 2) +
ease_aes("cubic-in-out")
animate(p_anim, nframes = 120, fps = 20, width = 900, height = 500)
animate(p_anim, nframes = 120, fps = 20, width = 900, height = 500)
anim_save("signal_plus_noise_density.gif")
anim_save("signal_plus_noise_density.gif")
file.info("signal_plus_noise_density.gif")$size
animate(p_anim, nframes = 20, fps = 20, width = 900, height = 500)
anim_save("signal_plus_noise_density.gif")
file.info("signal_plus_noise_density.gif")$size
anim_save("signal_plus_noise_density2.gif")
file.info("signal_plus_noise_density2.gif")$size
getwd()
animate(
p_anim,
nframes = 60,      # fewer frames
fps = 10,          # simpler timing
width = 600,
height = 360,
renderer = magick_renderer()
)
1
animate(
p_anim,
nframes = 60,      # fewer frames
fps = 10,          # simpler timing
width = 600,
height = 360,
renderer = magick_renderer()
)
## using ImageMagick
animate(
p_anim,
nframes = 120,      # fewer frames
fps = 20,          # simpler timing
width = 900,
height = 500,
renderer = magick_renderer()
)
anim_save("signal_plus_noise_ppt3.gif")
## using ImageMagick
animate(
p_anim,
nframes = 120,
fps = 8,        # slower, more legible
width = 800,
height = 450,
renderer = av_renderer("signal_plus_noise.mp4")
)
# ============================================================
# Gamma GLM intro: Observed = Signal * Noise
# Observed distribution is Gamma; noise is multiplicative
# Density plots + animation (Observed / Signal / Noise)
# ============================================================
```{r}
library(tidyverse)
library(gganimate)
set.seed(1)
# --- 1) Simulate a Gamma DGP ---------------------------------
n <- 4000
x <- runif(n, -2, 2)
# Positive mean structure (signal): log-link style
# mu = exp(eta) ensures positivity
eta <- 0.8 + 0.7 * x + 0.4 * sin(2 * x)
mu  <- exp(eta)  # signal on response scale
# Choose Gamma shape (controls CV). Larger shape -> less noise.
shape_k <- 3
# Gamma GLM parameterization:
# If Y ~ Gamma(shape=k, scale=theta), then E[Y] = k*theta
# Set theta = mu/k so E[Y]=mu
y <- rgamma(n, shape = shape_k, scale = mu / shape_k)
# Multiplicative noise (mean 1):
# eps = y / mu  ~ Gamma(shape=k, scale=1/k) in expectation
eps <- y / mu
# --- 2) Tidy data for densities -------------------------------
d_long <- tibble(
Observed = y,
Signal   = mu,
Noise    = eps
) |>
pivot_longer(everything(), names_to = "component", values_to = "value") |>
mutate(component = factor(component, levels = c("Observed", "Signal", "Noise")))
# --- 3) Static plot (optional) --------------------------------
p_static <- ggplot(d_long, aes(value, fill = component)) +
geom_density(alpha = 0.35) +
theme_minimal() +
labs(
x = NULL, y = "Density",
title = "Gamma GLM intuition: Observed = Signal × Noise",
subtitle = "Observed Y is Gamma; Noise (Y/μ) is right-skewed with mean ~ 1"
) +
guides(fill = "none")
p_static
# --- 4) Animation setup: show Observed -> Signal -> Noise ------
stages <- tibble(
stage = factor(c("Observed", "Signal", "Noise"),
levels = c("Observed", "Signal", "Noise"))
)
d_anim <- d_long |>
crossing(stages) |>
mutate(alpha_stage = case_when(
stage == "Observed" & component == "Observed" ~ 0.85,
stage == "Observed"                           ~ 0.00,
stage == "Signal"   & component == "Observed" ~ 0.25,
stage == "Signal"   & component == "Signal"   ~ 0.65,
stage == "Signal"                             ~ 0.00,
stage == "Noise"    & component == "Observed" ~ 0.15,
stage == "Noise"    & component == "Signal"   ~ 0.20,
stage == "Noise"    & component == "Noise"    ~ 0.75,
TRUE ~ 0.00
))
p_anim <- ggplot(d_anim, aes(value, fill = component)) +
geom_density(aes(alpha = alpha_stage)) +
theme_minimal() +
labs(
x = NULL, y = "Density",
title = "{closest_state}"
) +
guides(fill = "none", alpha = "none") +
transition_states(
stage,
transition_length = 3,  # slower transitions
state_length = 4        # longer pause on each stage
) +
ease_aes("cubic-in-out")
# --- 5) Render for PowerPoint: MP4 (recommended) ---------------
# Requires: install.packages("av") on some setups
animate(
p_anim,
nframes = 140,
fps = 8,
width = 900,
height = 500,
renderer = av_renderer("gamma_signal_noise.mp4")
)
# If you prefer GIF (sometimes PPTX is picky), try:
# animate(p_anim, nframes = 120, fps = 8, width = 700, height = 400, renderer = magick_renderer())
anim_save("signal_plus_noise_ppt4.gif")
# ============================================================
# Gamma GLM intro (unimodal): Observed = Signal × Noise
# Observed Y is Gamma; Noise (Y/μ) is Gamma-like with mean ~ 1
# Animation (Observed / Signal / Noise), slower transitions
# ============================================================
```{r}
library(tidyverse)
library(gganimate)
set.seed(1)
# --- 1) Simulate a Gamma DGP with unimodal signal --------------
n <- 5000
# Predictor with unimodal distribution
x <- rnorm(n, mean = 0, sd = 1)
# Signal: log-link style, monotone (NO sine term)
eta <- 1.1 + 0.5 * x
mu  <- exp(eta)  # positive, unimodal distribution across x
# Gamma noise strength (larger = less noisy)
shape_k <- 6
# Observed outcome: Y | mu ~ Gamma(shape=k, scale=mu/k)
y <- rgamma(n, shape = shape_k, scale = mu / shape_k)
# Multiplicative noise (residual factor): eps = Y / mu, mean ~ 1
eps <- y / mu
# --- 2) Tidy data for densities -------------------------------
d_long <- tibble(
Observed = y,
Signal   = mu,
Noise    = eps
) |>
pivot_longer(everything(), names_to = "component", values_to = "value") |>
mutate(component = factor(component, levels = c("Observed", "Signal", "Noise")))
# --- 3) Static check (should be unimodal) ----------------------
ggplot(d_long, aes(value, fill = component)) +
geom_density(alpha = 0.35) +
theme_minimal() +
labs(
x = NULL, y = "Density",
title = "Gamma GLM intuition: Observed = Signal × Noise",
subtitle = "Unimodal signal → unimodal observed Gamma mixture (typically)"
) +
guides(fill = "none")
# --- 4) Animation: Observed -> Signal -> Noise -----------------
stages <- tibble(
stage = factor(c("Observed", "Signal", "Noise"),
levels = c("Observed", "Signal", "Noise"))
)
d_anim <- d_long |>
crossing(stages) |>
mutate(alpha_stage = case_when(
stage == "Observed" & component == "Observed" ~ 0.85,
stage == "Observed"                           ~ 0.00,
stage == "Signal"   & component == "Observed" ~ 0.25,
stage == "Signal"   & component == "Signal"   ~ 0.65,
stage == "Signal"                             ~ 0.00,
stage == "Noise"    & component == "Observed" ~ 0.15,
stage == "Noise"    & component == "Signal"   ~ 0.20,
stage == "Noise"    & component == "Noise"    ~ 0.75,
TRUE ~ 0.00
))
p_anim <- ggplot(d_anim, aes(value, fill = component)) +
geom_density(aes(alpha = alpha_stage)) +
theme_minimal() +
labs(x = NULL, y = "Density", title = "{closest_state}") +
guides(fill = "none", alpha = "none") +
transition_states(
stage,
transition_length = 4,  # slower transition
state_length = 6        # longer pause
) +
ease_aes("cubic-in-out")
# --- 5) Render for PowerPoint (MP4 is most reliable) ----------
animate(
p_anim,
nframes = 180,
fps = 8,
width = 900,
height = 500,
renderer = av_renderer("gamma_signal_noise_unimodal.mp4")
)
getwd()
anim_save("gamma_signal_noise_final.gif")
---
title: "plotting_noise"
